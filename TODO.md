# План разработки (пошагово) — профессионально, подробно и без лишней сложности

Отлично — у нас уже есть полное и чёткое ТЗ. Ниже — детальный план разработки `AutoRent` (вариант 19) — разбитый на понятные этапы, задачи, чек-листы приёмки и рекомендации для быстрой и надёжной реализации. Я действую как практический инженер: фокус на «минимально необходимое + чистая архитектура + лёгкость правок», чтобы проект быстро сдавался и легко поддерживался.

---

# 1. Цели плана (кратко)

* Реализовать весь функционал из ТЗ по 5 лабораторным работам (EF Core, CRUD+LINQ, Word, Excel, HTML).
* Сделать код читаемым, модульным и легко расширяемым.
* Подготовить проект так, чтобы одногруппник мог собрать и запустить по инструкции без чтения методички.
* Минимизировать внешние зависимости и сложность разработки (принцип KISS).

---

# 2. Основные вехи (milestones) — порядок выполнения (без временных оценок)

1. Инициализация проекта + репозиторий + структура кода.
2. Модели данных + DbContext + миграции + демонстрационные сиды.
3. Базовый UI: формы и привязки DataGridView для Cars / Clients / Rentals (CRUD).
4. Логика выдачи/возврата (проверка доступности, расчёт стоимости).
5. LINQ-фильтры и сценарии выборок (требования ЛР2).
6. Экспорт/импорт Excel (ЛР4) — базовый + проверка дубликатов.
7. Генерация Word по шаблонам (ЛР3).
8. Генерация HTML-отчётов (ЛР5).
9. Тестирование, документация для лабораторной, отчёт с листингами и скриншотами.
10. Финальная проверка соответствия методичке и упаковка для передачи одногруппнику.

---

# 3. Детализированный список задач (порядок, подзадачи, приёмка)

## Веха 1 — Инициализация проекта

Задачи:

* Создать Git-репозиторий (локально + удалённый: GitHub/GitLab/Bitbucket по желанию).
* Создать WinForms проект (.NET 8 рекомендуем, .NET 7 допустим): `dotnet new winforms -n AutoRent`
* Добавить .gitignore (.NET), README с краткой инструкцией «как запустить».
* Создать ветку `develop`, основную ветку `main` (protected).
  Приёмка:
* В репозитории есть `README.md`, `sln` и пустой проект, ветка `develop` создана.

Рекомендации по коммитам:

* Мелкие коммиты с осмысленными сообщениями: `feat(db): add models and dbcontext`, `chore: add readme`, `fix(ui): data binding fixes`.

## Веха 2 — Модели и DbContext + миграции

Задачи:

* Добавить пакеты EF Core и провайдер (пример PostgreSQL):

  ```
  dotnet add package Microsoft.EntityFrameworkCore
  dotnet add package Microsoft.EntityFrameworkCore.Tools
  dotnet add package Npgsql.EntityFrameworkCore.PostgreSQL
  ```
* Создать папки: `Models`, `Data`.
* Реализовать сущности `Car`, `Client`, `Rental` согласно ТЗ (включая навигационные свойства).
* Реализовать `AutoRentContext` с Fluent API: ключи, связи, `OnDelete(DeleteBehavior.Cascade)`.
* Настроить файл конфигурации подключения (appsettings.json or simple local config) и механизм считывания строки подключения.
* Настроить сиды (seed) — немного тестовых данных (3–5 машин, 2–3 клиента, 1–2 аренды) для удобного тестирования.
* Добавить миграцию и создать БД (команды указать в README):

  ```
  dotnet ef migrations add InitCreate
  dotnet ef database update
  ```

Приёмка:

* Миграции создаются и применяются успешно; тестовые данные видны в БД.

## Веха 3 — Базовый UI и CRUD

Задачи:

* Создать главную форму (`MainForm`) с TabControl: `Cars`, `Clients`, `Rentals`, `Reports`, `ImportExport`.
* Для каждой сущности — отдельная форма/панель с `DataGridView` + кнопки Add/Edit/Delete + фильтры.
* Сделать модели представления (при необходимости DTO/ViewModel) для привязки.
* Реализовать паттерн минимального слоя репозитория (опционально — `IRepository<T>`/`Repository<T>`), либо аккуратно инкапсулировать операции `DbContext` в `DataService`.
* Обязательно оборачивать `SaveChanges()` в `try/catch` и логировать ошибки.
* UI: использовать `BindingSource` для простоты (поддерживает `Local.ToBindingList()` для EF).
  Приёмка:
* CRUD работает: создать/редактировать/удалить записи в каждой таблице и увидеть изменения в БД.

## Веха 4 — Логика выдачи/возврата (ключевая ЛР)

Задачи:

* Форма выдачи (в `RentalsForm`): выбор клиента и автомобиля (ComboBox), даты, price per day (подгружается из Car.RentalPricePerDay), валидация.
* Реализовать проверку доступности: перед созданием Rental выполнить запрос, есть ли пересекающиеся активные аренды `WHERE CarId = x AND (ActualReturnDate IS NULL OR PlannedReturnDate >= DateOut)`.
* При создании копировать `PricePerDay` в Rental (фиксация цены).
* При возврате: ввод `ActualReturnDate` и вычисление `TotalPrice = PricePerDay * Days + штрафы (опционально)`. Автоматическое изменение `IsAvailable`/обновление статуса (если такой флаг используется).
* Юнит/интеграционные проверки (ручные тест-кейсы).
  Приёмка:
* Нельзя выдать машину, если она занята на пересекающийся период.
* При возврате правильно считается стоимость и запись обновляется.

## Веха 5 — LINQ-фильтры и выборки (ЛР2)

Задачи:

* Минимум два фильтра: по двум полям (например, `Make` + `Type`) и фильтр выдач по фамилии клиента (связь таблиц).
* Реализовать быстрый поиск (textbox + debounce) для DataGridView.
* Добавить одну сложную выборку (пример: «список машин, которые не сдавались более 30 дней» или «топ-5 клиентов по суммарному доходу»).
  Приёмка:
* Фильтрация работает корректно и одна из фильтраций использует JOIN между таблицами.

## Веха 6 — Экспорт/импорт Excel (ЛР4)

Задачи:

* Выбрать библиотеку: EPPlus или OpenXML. Для простоты и отсутствия Interop зависимостей — EPPlus рекомендуем, но EPPlus лицензия требует внимания; OpenXML — свободна.
* Реализовать экспорт:

  * Отчёт «AllData» (все таблицы), таблицы, подстановки (фамилия клиента, марка авто).
  * Финансовый отчёт (агрегация по дням/месяцам).
* Реализовать импорт из `.xlsx`:

  * Валидация строк (обязательные поля, форматы дат).
  * Обнаружение дубликатов по ключевым полям (например, для клиентов — телефон + фамилия).
  * Формирование отчёта импорта: `added`, `skipped (duplicate)`, `errors`.
* UI: диалог импорта с выбором файла и отображением статистики.
  Приёмка:
* Успешный экспорт/импорт; отчёт импорта содержит статистику; дубликаты не создаются.

## Веха 7 — Генерация Word (ЛР3)

Задачи:

* Выбрать способ: OpenXML (без COM) или Interop (если нужен полноценный Word и локально установлен Office). Для лабораторного проекта лучше OpenXML/DocX/ClosedXML-Extensions — чтобы не требовать Word на машине.
* Подготовить 2 шаблона (договор аренды, акт выдачи) с плейсхолдерами `{ClientName}`, `{Car}`, `{DateOut}`, `{PlannedReturnDate}`, `{Price}`.
* Реализовать генерацию: поиск/замена плейсхолдеров, вставка таблицы (акты/детали).
* Кнопка «Сформировать договор» — сохраняет файл и предлагает открыть.
  Приёмка:
* Два шаблона генерируются, значения корректно подставляются, таблицы отображаются в документе.

## Веха 8 — HTML-отчёты (ЛР5)

Задачи:

* Формировать HTML-шаблоны (игнорировать внешние CSS зависимости — встроить базовые стили).
* Реализовать минимум 2 отчёта: «Текущие аренды», «Группировка по клиентам».
* Сохранение через `SaveFileDialog`.
  Приёмка:
* HTML-файлы корректно открываются в браузере и содержат нужные данные и группировки.

## Веха 9 — Тестирование, документация и отчёт для методички

Задачи:

* Написать краткие ручные тест-кейсы (по каждому UC) и чек-лист.
* Сделать скриншоты рабочих форм: Cars, Clients, Rentals(выдача), Word/Excel/HTML-отчёты.
* Собрать отчёт по методичке: цели, что реализовано, листинги ключевых файлов (DbContext, модели, CRUD, экспорт/импорт, Word-gen), инструкции по запуску миграций и запуску проекта.
  Приёмка:
* Отчёт готов, скриншоты присутствуют, в README — шаги «как запустить» + команда миграции.

## Веха 10 — Финальная проверка и упаковка

Задачи:

* Пройти чек-лист методички: убедиться, что все требования ЛР1–ЛР5 выполнены.
* Закоммитить финальные изменения, сделать `tag` релиза (например `v1.0-lab`).
* Подготовить архив/инструкцию для одногруппника: где найти solution, как выполнить миграции, что поменять в строке подключения, какие seed-данные.
  Приёмка:
* У пользователя есть всё чтобы запустить проект и получить требуемые отчёты.

---

# 4. Подробные приёмо-сдаточные критерии (по лабораторным)

### ЛР1 (EF Core)

* Есть `AutoRentContext` и миграция `InitCreate`.
* В БД минимум 3 таблицы с >=3 полями в каждой.
* Связи настроены, `OnDelete(DeleteBehavior.Cascade)` там, где нужно.

### ЛР2 (CRUD + LINQ)

* DataGridView + Add/Edit/Delete для каждой сущности.
* Фильтрация по 2 полям и фильтр выдач по фамилии клиента (JOIN).
* `SaveChanges()` в try/catch.

### ЛР3 (Word)

* 2 шаблона Word, плейсхолдеры заменяются, минимум один документ содержит таблицу.

### ЛР4 (Excel)

* Экспорт «AllData» и агрегированный финансовый отчет.
* Импорт xlsx с проверкой дубликатов и отчётом результата.

### ЛР5 (HTML)

* 2 HTML-отчёта; один с группировкой; корректное сохранение через SaveFileDialog.

---

# 5. Архитектурные рекомендации и соглашения по коду

* **Паттерн уровней:** UI ↔ Services (DataService/Repository) ↔ Data (DbContext) ↔ Models.
* **Именования:** PascalCase для классов/методов, camelCase для приватных полей с префиксом `_` (например `_context`).
* **Структура папок:**

  ```
  /AutoRent
    /AutoRent.sln
    /AutoRent.UI (WinForms)
      /Forms
      /Views
    /AutoRent.Data
      /Models
      /Context
      /Migrations
    /AutoRent.Services
      /Repositories
      /ImportExport
      /Reports
    /docs
  ```
* **Независимость от Interop:** использовать OpenXML/EPPlus/DocX где возможно, чтобы не требовать установленный Office.
* **Логирование:** простой лог в текстовый файл (`logs/app.log`) с уровнем `ERROR/INFO` (можно использовать `Serilog` минимально).
* **Конфигурация:** `appsettings.json` с примером строки подключения `Host=...;Database=...;Username=...;Password=...`.

---

# 6. Git workflow и ветвление

* `main` — стабильный код для сдачи.
* `develop` — основная для разработки.
* Фичи: `feature/<short-desc>` (пример `feature/rentals-availability`).
* Исправления: `hotfix/<desc>`.
* Pull requests в `develop`, код-ревью хотя бы самим собой (или автотесты/CI).
* Правила коммитов: `type(scope): short description` (например `feat(rentals): add availability check`).

---

# 7. QA: тесты и ручные сценарии (ключевые тест-кейсы)

Ручные кейсы (обязательные):

1. Создать клиента → проверить запись в БД.
2. Добавить машину → проверить `RentalPricePerDay`.
3. Создать аренду на период → попытаться создать вторую аренду на тот же период для той же машины → должна быть ошибка.
4. Закрыть аренду (ввести фактическую дату) → проверка расчёта `TotalPrice`.
5. Экспорт в Excel → открыть файл → проверить данные.
6. Импорт клиентов из Excel с дубликатами → убедиться, что дубликаты пропущены и показан отчёт.
7. Сгенерировать договор Word → открыть договор → проверить подстановку плейсхолдеров.
8. Сгенерировать HTML-отчёт и открыть в браузере.

Unit tests (опционально, но рекомендую):

* Тест на функцию проверки пересекающихся дат (availability).
* Тест на расчёт стоимости аренды.
* Тесты для импортной валидации (валидный/невалидный ряд).

---

# 8. Документация и отчёт для преподавателя (что положить в финальный пакет)

* `README.md` — краткий путь запуска + строки команд миграций.
* `LabReport.docx` или `.pdf` — содержимое по методичке: цель, постановка задачи, ER-диаграмма (PlantUML картинка), листинги ключевого кода, скриншоты, инструкции для запуска миграций.
* `AutoRent.zip` — исходники (или ссылка на репозиторий).
* Скриншоты: CRUD форм, пример Word/Excel/HTML-отчёта.
* `migration` папка и SQL-дамп (опционально) — чтобы преподаватель мог развернуть БД вручную.

---

# 9. Упрощения (чтобы сдать быстро, но корректно)

Если цель — быстро и корректно сдать лабы без лишнего усложнения, делать так:

* Использовать SQLite или LocalDB для разработки (минимально настраиваемая, не требует внешнего сервера). Но в ТЗ указан провайдер — отметьте в отчёте выбор (например SQLite для удобства). Если преподаватель требует PostgreSQL — переключиться к нему.
* Для Word/Excel использовать библиотеки без COM (OpenXML/EPPlus), чтобы не требовать Word/Excel на машине проверяющего.
* Ограничить дополнительные поля и фичи — реализовать базовый рабочий набор, но качественно.

---

# 10. Чек-лист: что нужно сделать прямо сейчас (конкретные команды и файлы)

1. Инициализация:

   * `dotnet new winforms -n AutoRent.UI`
   * Создать решение: `dotnet new sln -n AutoRent`
   * Добавить проекты в solution: `dotnet sln add ./AutoRent.UI/AutoRent.UI.csproj`
2. Добавить EF Core и провайдер:

   ```
   dotnet add ./AutoRent.UI package Microsoft.EntityFrameworkCore
   dotnet add ./AutoRent.UI package Microsoft.EntityFrameworkCore.Tools
   dotnet add ./AutoRent.UI package Npgsql.EntityFrameworkCore.PostgreSQL
   ```

   (если используете отдельный проект Data — добавляйте туда)
3. Создать `Models` и `AutoRentContext` (создайте файлы `Car.cs`, `Client.cs`, `Rental.cs`, `AutoRentContext.cs`).
4. Запустить миграции (после реализации `DbContext`):

   ```
   dotnet ef migrations add InitCreate
   dotnet ef database update
   ```
5. Создать пустую форму `MainForm` с TabControl.

> Это минимальный «пусковой набор». Если хотите — могу сгенерировать шаблонный skeleton-код моделей + DbContext и пример MainForm прямо сейчас (показываю код). Скажите, нужно ли? *(не спрашиваю, а предлагаю — если хотите, могу сразу сгенерировать)*

---

# 11. Риски и простые способы их избежать

* **Риск:** требование к провайдеру БД (у преподавателя может быть PostgreSQL). Решение: оставить возможность конфигурировать строку подключения и дать инструкцию переключения провайдера.
* **Риск:** Interop требует Office на тестовой машине. Решение: использовать OpenXML/EPPlus.
* **Риск:** проблемы с миграциями у проверяющего. Решение: приложить SQL-дамп и подробную инструкцию `dotnet ef database update`.

---

# 12. Заключение — что получит одногруппник/преподаватель

* Чистый, читаемый проект WinForms с реализованными ЛР1–ЛР5.
* Точный README с командами для миграций и запуском.
* Готовые шаблоны Word/Excel/HTML-отчётов и интерфейс для их генерации.
* Отчёт для методички с листингами и скриншотами.

---

Если хотите, я могу прямо сейчас:

* а) сгенерировать skeleton-код (Models + DbContext + пример сидов + пример `appsettings.json`) — код готов к вставке;
* б) или сразу написать MainForm skeleton с DataGridView и примером CRUD кода.

Выбирайте один из пунктов (a или b) — и я сгенерирую файлы/листинги прямо в чате.
